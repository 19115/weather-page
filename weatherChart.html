<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      body {
        background: linear-gradient(to right, #6dd5ed, #383837);
        background-size: cover;
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-position: center;
        min-height: 100vh;
      }

      .bg-sunny {
        background: linear-gradient(to right, #fceabb, #f8b500);
        color: #222;
      }
      .bg-rainy {
        background: linear-gradient(to right, #74ebd5, #acb6e5);
        color: #222;
      }
      .bg-cloudy {
        background: linear-gradient(to right, #bdc3c7, #2c3e50);
        color: #fff;
      }
      .bg-calm {
        background: linear-gradient(to right, #dfe9f3, #ffffff);
        color: #222;
      }
    </style>
    <title>Weather chart</title>
  </head>
  <body>
    <div class="container">
      <div class="card shadow p-4 w-auto mx-auto" style="max-width: 800px">
        <div class="row mb-3">
          <div class="col-12 col-md-3">
            <input
              type="text"
              class="form-control w-100"
              id="inputCity"
              placeholder="Enter city name"
            />
            <button class="btn btn-info mt-2" id="cityBtn">Search</button>
          </div>
          <div class="col-12 col-md-6">
            <h4 class="text-success" id="city">Nairobi</h4>
            <p id="weather">
              <span id="weatherText">partly cloudy</span>
              <span id="weatherIcon" class="ms-2"></span>
            </p>
            <p id="temperature">18° C</p>
          </div>
        </div>
        <div
          class="d-flex justify-content-between align-items-center mt-3 text-muted"
        >
          <button class="btn btn-success" id="refreshBtn">Refresh</button>
        </div>
        <!-- timedate div -->
        <div
          id="dateTimeDisplay"
          class="text-center mt-3 text-light bg-secondary"
        ></div>
      </div>
    </div>
    <script>
      let input = document.getElementById("inputCity");
      let cityDisplay = document.getElementById("city");

      //   datetime function
      function updateTime() {
        const now = new Date();
        const options = {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: true,
        };
        const formatted = now.toLocaleString("en-US", options);
        document.getElementById("dateTimeDisplay").textContent = formatted;
      }

      updateTime();
      setInterval(updateTime, 1000);
      //   icons
      const weatherIcons = {
        Clear: "fas fa-sun text-warning",
        Rain: "fas fa-cloud-showers-heavy text-primary",
        Clouds: "fas fa-cloud text-secondary",
        Drizzle: "fas fa-cloud-rain text-info",
        Thunderstorm: "fas fa-bolt text-warning",
        Snow: "fas fa-snowflake text-info",
        Mist: "fas fa-smog text-muted",
        Smoke: "fas fa-smog text-muted",
        Haze: "fas fa-smog text-muted",
        Dust: "fas fa-smog text-muted",
        Fog: "fas fa-smog text-muted",
        Sand: "fas fa-smog text-muted",
        Ash: "fas fa-smog text-muted",
        Squall: "fas fa-wind text-info",
        Tornado: "fas fa-wind text-danger",
      };

      const weatherBackground = {
        Clear: "bg-sunny",
        Rain: "bg-rainy",
        Clouds: "bg-cloudy",
        Drizzle: "bg-rainy",
        Thunderstorm: "bg-rainy",
        Snow: "bg-calm",
        Mist: "bg-calm",
        Smoke: "bg-calm",
        Haze: "bg-calm",
        Dust: "bg-calm",
        Fog: "bg-calm",
        Sand: "bg-calm",
        Ash: "bg-calm",
        Squall: "bg-calm",
        Tornado: "bg-calm",
      };

      // const API_KEY = "672f9ae8e7afee850919bceb3d9b86a3";
      // script.js
      fetch(`https://api.example.com/data?api_key=${API_KEY}`)
        .then((response) => response.json())
        .then((data) => console.log(data));

      let currentCity = "Nairobi";

      function fetchWeather(cityName) {
        let currentCity = "Nairobi";

        const url = `https://api.openweathermap.org/data/2.5/weather?q=${cityName}&appid=${API_KEY}&units=metric`;

        fetch(url)
          .then((response) => {
            if (!response.ok) {
              throw new Error("City not found");
            }
            return response.json();
          })
          .then((data) => {
            const temp = Math.round(data.main.temp);
            const weather = data.weather[0].main;

            document.getElementById("city").textContent = data.name;
            document.getElementById("temperature").textContent = `${temp} °C`;
            document.getElementById("weatherText").textContent = weather;

            //icons update
            const weatherIcon = document.getElementById("weatherIcon");
            weatherIcon.className = "";
            if (weatherIcons[weather]) {
              weatherIcon.className = weatherIcons[weather] + " ms-2";
            }

            //background
            const card = document.querySelector(".card");
            Object.values(weatherBackground).forEach((cls) =>
              card.classList.remove(cls)
            );
            if (weatherBackground[weather]) {
              card.classList.add(weatherBackground[weather]);
            }
          })
          .catch((error) => {
            alert(error.message);
          });
      }
      // weather for the card's initial city
      window.addEventListener("DOMContentLoaded", () => {
        fetchWeather("Nairobi");
      });

      document.getElementById("cityBtn").onclick = function () {
        const cityName = input.value.trim();
        if (cityName) {
          fetchWeather(cityName);
          input.value = "";
        } else {
          alert("Please enter a city name");
        }
      };
      // refresh button
      document.getElementById("refreshBtn").onclick = function () {
        fetchWeather(currentCity);
      };
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
